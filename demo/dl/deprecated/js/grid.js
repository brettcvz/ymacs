// @require container.js
(function(){function DlGrid(args){args&&(D.setDefaults(this,args),typeof this._rowType=="string"&&(this._rowType=eval(this._rowType)),this._rowType||(this._rowType=DlGridRow),typeof this._headType=="string"&&(this._headType=eval(this._headType)),this._headType||(this._headType=DlGridHeadLabel),DlContainer.call(this,args))}function onBodyScroll(){this.getHeaderDiv().scrollLeft=this.getBodyDiv().scrollLeft}function startResize(a,b,c){var d,e,f,g,h;c||(c=window.event),d=a.offsetLeft,e=DlResizeBar.getDragBar(),f=e.style,f.left=d-this.getBodyDiv().scrollLeft+1+"px",f.height="100%",f.width=a.offsetWidth-2+"px",f.top="0px",this.getElement().appendChild(e),g=DlDialog.activateEventStopper(!0),DOM.addClass(g,"CURSOR-RESIZE-E"),DlEvent.captureGlobals(this._resizeCaptures),h=new DlEvent(c),this._resize={div:a,col:b,pos:d,orig:this.getActualColWidth(b.getIndex()),mouse:h.pos.x},DOM.stopEvent(c)}function doResize(a){var b=DlResizeBar.getDragBar(),c=this._resize.pos+a.pos.x-this._resize.mouse,d=c-this._resize.pos,e=this._resize.orig+d;e<MIN_COL_WID&&(c+=MIN_COL_WID-e,e=MIN_COL_WID),c-=this.getBodyDiv().scrollLeft,b.style.left=c+1+"px"}function stopResize(a){var b,c=this._resize.pos+a.pos.x-this._resize.mouse,d=c-this._resize.pos,e=this._resize.orig+d;e<MIN_COL_WID&&(c+=MIN_COL_WID-e,e=MIN_COL_WID),d=e-this._resize.orig,this.setColSize(this._resize.col,e),this._updateFillCols(d),this.getElement().removeChild(DlResizeBar.getDragBar()),DlEvent.releaseGlobals(this._resizeCaptures),b=DlDialog.activateEventStopper(!1),DOM.delClass(b,"CURSOR-RESIZE-E")}var MIN_COL_WID,SO,SI,HTML,BASE=DlGrid.inherits(DlContainer);eval(Dynarch.EXPORT("DlGrid",!0)),MIN_COL_WID=20,D.DEFAULT_ARGS={_model:["model",null],_selType:["selType","row"],_rowType:["rowType",null],_headType:["headType",null]},SO=DOM.setOuterSize,SI=DOM.setInnerSize,HTML=String.buffer("<div class='DlGrid-Headers'>","<table class='DlGrid-Table' cellspacing='0' cellpadding='0'>","<tbody><tr></tr></tbody></table></div>","<div class='DlGrid-Body'>","<table class='DlGrid-Table' cellspacing='0' cellpadding='0'>","<tbody></tbody></table></div>").get(),P._createElement=function(){BASE._createElement.call(this),this._rowsGroup=DlRadioGroup.get(),this.setContent(HTML),this.getBodyDiv().onscroll=onBodyScroll.$(this),this._initHeaders(),this._initBody()},P.getGroup=function(){return this._rowsGroup},P.getHeaderDiv=function(){return this.getElement().firstChild},P.getHandlesDiv=function(){var a=this.getHeaderDiv().childNodes[1];return a||(a=CE("div",null,{className:"DlGrid-Handles"},this.getHeaderDiv()),this._resizeCaptures={onMouseMove:doResize.$(this),onMouseUp:stopResize.$(this),onMouseOver:DlException.stopEventBubbling,onMouseOut:DlException.stopEventBubbling,onMouseEnter:DlException.stopEventBubbling,onMouseLeave:DlException.stopEventBubbling}),a},P.getHeaderRow=function(){return this.getHeaderDiv().firstChild.rows[0]},P.getBodyDiv=function(){return this.getElement().childNodes[1]},P.getBodyTable=function(){return this.getBodyDiv().firstChild},P._onHeadClick=function(){},P._appendWidgetElement=function(a,b){var c,d;a instanceof this._rowType?(c=this.getBodyTable(),b!=null?(d=c.rows[b],d?d.parentNode.insertBefore(a.getElement(),d):c.firstChild.appendChild(a.getElement())):c.firstChild.appendChild(a.getElement())):BASE._appendWidgetElement.apply(this,arguments)},P._initHeaders=function(){var a=this._onHeadClick.$(this);this._model.foreachCol(function(b){var c,d=document.createElement("td");this.getHeaderRow().appendChild(d),c=this._makeHeadLabel({parent:this,appendArgs:d,iconClass:b.getIconClass(),label:b.getLabel(),column:b,className:"DlGrid-align-"+b.getStyle("textAlign","left"),tooltip:b.tooltip}),b._button=c,c.addEventListener("onClick",a)},this)},P._makeRow=function(a){return new this._rowType(a)},P._makeHeadLabel=function(a){return new this._headType(a)},P._initBody=function(){this._model.foreachRow(function(a){a=this._makeRow({parent:this,group:this._rowsGroup,value:a.id,model:a})},this),this._model.addEventListener({onInsertRow:this._insertRow.$(this),onDeleteRow:this._deleteRow.$(this),onSort:this._sort.$(this)})},P._insertRow=function(a){var b,c,d,e,f,g=a.getIndex();a=this._makeRow({parent:this,group:this._rowsGroup,value:a.id,model:a,appendArgs:g}),b=a.getElement().cells,c=this.getHeaderRow().cells;for(d=b.length;--d>=0;)e=b[d],f=c[d].offsetWidth,SO(e.firstChild,f,null),SI(e,f,null)},P._deleteRow=function(a){var b=a.getIndex();a=this.getRowByIndex(b),a.destroy()},P._sort=function(a,b,c,d){var e,f,g;b&&(b._button.delClass("DlGridHeadLabel-sort-up"),b._button.delClass("DlGridHeadLabel-sort-down")),a&&(a._button.condClass(c,"DlGridHeadLabel-sort-down","DlGridHeadLabel-sort-up"),e=this.getBodyTable(),f=e.firstChild,g=e.rows,d=d.map(function(a){return g[a]}),d.foreach(function(a){f.appendChild(a)}))},P.__doLayout=function(){var a=this.getInnerSize(),b=this.getBodyDiv(),c=this.getHeaderDiv();SO(b,a.x,a.y-c.offsetHeight),SO(c,a.x,null),c.style.marginRight=-DOM.getScrollbarSize(b).x+"px",this.__hasLayout?this._updateFillCols():(this._initColSizes(),this.__hasLayout=!0,this.getBodyTable().style.width=""),onBodyScroll.call(this)},P.getRowByIndex=function(a){try{return DlWidget.getFromElement(this.getBodyTable().rows[a])}catch(b){}},P.getRowById=function(a){return this.getRowByIndex(this._model.getRowById(a).getIndex())},P.getActualColWidth=function(a){return this.getHeaderRow().cells[a].offsetWidth},P._initColSizes=function(){function e(d){var e,f=d.fill?Math.floor(a*d.fill):d.width||this.getActualColWidth(d.getIndex());f=this.setColSize(d,f,!0),c+=f,d.isResizable&&!d._resizeHandle&&(e=CE("div",{left:c+"px",height:b},{className:"DlGrid-resizeHandle"},this.getHandlesDiv()),is_ie&&DOM.setUnselectable(e,!0),e.dl_resizeCol=d,d._resizeHandle=e,e.onmousedown=startResize.$(this,e,d))}var a,b=this.getHeaderDiv().offsetHeight+"px",c=0,d=this.getInnerSize().x-DOM.getScrollbarSize(this.getBodyDiv()).x;this._fillCols=[],this._model.foreachCol(function(a){a.fill?this._fillCols.push(a):c+=a.width||this.getActualColWidth(a.getIndex())},this),a=d-c,c=0,this._model.foreachCol(e,this)},P.setColSize=function(a,b,c){var d,e,f=a._button;return b!=null&&(f.setOuterSize({x:b}),d=f.getElement().parentNode,SO(d,b,null)),e=this.getBodyTable().rows[0],b=f.getOuterSize().x,a=a.getIndex(),Array.$(this.getBodyTable().rows).foreach(function(c){c&&(d=c.cells[a],SO(d.firstChild,b,null),SI(d,b,null))}),onBodyScroll.call(this),c||this._updateResizeHandles(),b},P._updateFillCols=function(a){var b;a==null&&(b=this.getBodyDiv(),a=this.getHeaderRow().offsetWidth-b.offsetWidth+DOM.getScrollbarSize(b).x),this._fillCols.foreach(function(b){var c=this.getActualColWidth(b.getIndex());c-=Math.round(b.fill*a),this.setColSize(b,c)},this)},P._updateResizeHandles=function(){this._model.foreachCol(function(a){var b;a._resizeHandle&&(b=a._button.getElement().parentNode,a._resizeHandle.style.left=b.offsetLeft+b.offsetWidth+"px")})},P._handle_focusKeys=function(a){var b,c=this.getGroup(),d=a.focusedWidget;switch(a.keyCode){case DlKeyboard.ARROW_UP:case DlKeyboard.ARROW_DOWN:case DlKeyboard.PAGE_UP:case DlKeyboard.PAGE_DOWN:b=a.keyCode==DlKeyboard.ARROW_UP||a.keyCode==DlKeyboard.PAGE_UP?this.getPrevRow(d):this.getNextRow(d),b?(b.focus(),a.shiftKey&&this._selType=="multiple"?(c.maxChecked(null),d.checked(!0),b.checked(!0)):this._selType!="multiple"&&(c.maxChecked(1),b.checked(!0))):(a.shiftKey||a.ctrlKey)&&d.checked(!0),a.domStop=!0,DlException.stopEventBubbling();break;case DlKeyboard.HOME:case DlKeyboard.END:b=a.keyCode==DlKeyboard.HOME?this.getRowByIndex(0):this.getRowByIndex(this.getBodyTable().rows.length-1),b&&(b.focus(),a.domStop=!0,this._selType!="multiple"&&(a.keyCode=DlKeyboard.ENTER,b._handle_focusKeys(a)),DlException.stopEventBubbling())}return BASE._handle_focusKeys.call(this,a)},P.getNextRow=function(a){return this.getRowByIndex(a.getModel().getIndex()+1)},P.getPrevRow=function(a){return this.getRowByIndex(a.getModel().getIndex()-1)}})(),function(){function DlGridRow(a){a&&(this._customMoveKeys=!0,D.setDefaults(this,a),DlAbstractButton.call(this,a))}function getTooltip(){var a=this.args.widget;return a.getModel().tooltip}function onDestroy(){this._model.removeEventListener("onChange",this._on_modelChange)}function displayCell(a,b,c){a.firstChild?a.firstChild.innerHTML=b.getContent():a.innerHTML='<div class="DlGrid-cellData">'+b.getContent()+"</div>",a.className="DlGrid-align-"+b.getStyle("textAlign",c.getStyle("textAlign","left"))}var BASE=DlGridRow.inherits(DlAbstractButton);eval(Dynarch.EXPORT("DlGridRow",!0)),D.DEFAULT_ARGS={_tagName:["tagName","tr"],_classes:["classes",{active:"DlGridRow-active",hover:"DlGridRow-hover",checked:"DlGridRow-1",unchecked:"DlGridRow-0",empty:"DlGridRow-empty",disabled:"DlGridRow-disabled"}],_btnType:["type",DlButton.TYPE.TWOSTATE],_model:["model",null],_focusable:["focusable",!0],__tooltip:["tooltip",getTooltip]},P.getModel=function(){return this._model},P._onClick=function(a){this.parent.getGroup().maxChecked(a.ctrlKey&&this.parent._selType=="multiple"?null:1),BASE._onClick.call(this,a)},P._handle_focusKeys=function(a){var b=this.parent,c=b.getGroup();if(a.keyCode!=DlKeyboard.ENTER)return BASE._handle_focusKeys.call(this,a);c.maxChecked(a.shiftKey||a.ctrlKey&&b._selType=="multiple"?null:1),this.applyHooks("onClick",[a]),a.domStop=!0},P._createElement=function(){var a;DlWidget.prototype._createElement.call(this),a=this.getElement(),this._model.foreachCell(function(b,c){var d=CE("td",null,null,a);displayCell(d,b,c)},this),this._on_modelChange=this._on_modelChange.$(this),this._model.addEventListener("onChange",this._on_modelChange),this.addEventListener("onDestroy",onDestroy)},P._on_modelChange=function(a,b,c){switch(c){case"value":displayCell(this.getElement().cells[b.getIndex()],b,this._model.model.getColByIndex(b.getIndex()))}}}(),function(){function DlGridHeadLabel(a){a&&(this.column=a.column,a.focusable=!1,this.__withIconClass="DlButton-withIcon",DlButton.call(this,a),this.column.isSortable||(this.__disabled=!0))}var BASE=DlGridHeadLabel.inherits(DlButton);eval(Dynarch.EXPORT("DlGridHeadLabel")),P.setWidth=function(a){this.setOuterSize({x:a})},P.label=function(){this.setContent("<div class='DlButton-Label'>"+this._label+"</div>")},P._onClick=function(){this.column.sort()},D.DEFAULT_ARGS={_classes:["classes",{active:"DlGridHeadLabel-active",hover:"DlGridHeadLabel-hover",checked:"DlGridHeadLabel-1",unchecked:"DlGridHeadLabel-0",empty:"DlGridHeadLabel-empty",disabled:"DlGridHeadLabel-disabled"}]}}();